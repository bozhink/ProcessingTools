!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(k){var t={pairs:"()[]{}''\"\"",triples:"",explode:"[]{}"},x=k.Pos;function y(e,r){return"pairs"==r&&"string"==typeof e?e:"object"==typeof e&&null!=e[r]?e[r]:t[r]}k.defineOption("autoCloseBrackets",!1,function(e,r,t){t&&t!=k.Init&&(e.removeKeyMap(i),e.state.closeBrackets=null),r&&(n(y(r,"pairs")),e.state.closeBrackets=r,e.addKeyMap(i))});var i={Backspace:function(e){var r=S(e);if(!r||e.getOption("disableInput"))return k.Pass;for(var t=y(r,"pairs"),n=e.listSelections(),i=0;i<n.length;i++){if(!n[i].empty())return k.Pass;var a=s(e,n[i].head);if(!a||t.indexOf(a)%2!=0)return k.Pass}for(var i=n.length-1;0<=i;i--){var o=n[i].head;e.replaceRange("",x(o.line,o.ch-1),x(o.line,o.ch+1),"+delete")}},Enter:function(n){var e=S(n),r=e&&y(e,"explode");if(!r||n.getOption("disableInput"))return k.Pass;for(var i=n.listSelections(),t=0;t<i.length;t++){if(!i[t].empty())return k.Pass;var a=s(n,i[t].head);if(!a||r.indexOf(a)%2!=0)return k.Pass}n.operation(function(){var e=n.lineSeparator()||"\n";n.replaceSelection(e+e,null),n.execCommand("goCharLeft"),i=n.listSelections();for(var r=0;r<i.length;r++){var t=i[r].head.line;n.indentLine(t,null,!0),n.indentLine(t+1,null,!0)}})}};function n(e){for(var r=0;r<e.length;r++){var t=e.charAt(r),n="'"+t+"'";i[n]||(i[n]=a(t))}}function a(r){return function(e){return function(i,e){var r=S(i);if(!r||i.getOption("disableInput"))return k.Pass;var t=y(r,"pairs"),n=t.indexOf(e);if(-1==n)return k.Pass;for(var a,o=y(r,"triples"),s=t.charAt(n+1)==e,l=i.listSelections(),c=n%2==0,f=0;f<l.length;f++){var h,u=l[f],d=u.head,p=i.getRange(d,x(d.line,d.ch+1));if(c&&!u.empty())h="surround";else if(!s&&c||p!=e)if(s&&1<d.ch&&0<=o.indexOf(e)&&i.getRange(x(d.line,d.ch-2),d)==e+e){if(2<d.ch&&/\bstring/.test(i.getTokenTypeAt(x(d.line,d.ch-2))))return k.Pass;h="addFour"}else if(s){var g=0==d.ch?" ":i.getRange(x(d.line,d.ch-1),d);if(k.isWordChar(p)||g==e||k.isWordChar(g))return k.Pass;h="both"}else{if(!c)return k.Pass;h="both"}else h=!s||(m=d,void 0,b=(v=i).getTokenAt(x(m.line,m.ch+1)),!/\bstring/.test(b.type)||b.start!=m.ch||0!=m.ch&&/\bstring/.test(v.getTokenTypeAt(m)))?0<=o.indexOf(e)&&i.getRange(d,x(d.line,d.ch+3))==e+e+e?"skipThree":"skip":"both";if(a){if(a!=h)return k.Pass}else a=h}var v,m,b;var C=n%2?t.charAt(n-1):e,P=n%2?e:t.charAt(n+1);i.operation(function(){if("skip"==a)i.execCommand("goCharRight");else if("skipThree"==a)for(var e=0;e<3;e++)i.execCommand("goCharRight");else if("surround"==a){for(var r=i.getSelections(),e=0;e<r.length;e++)r[e]=C+r[e]+P;i.replaceSelections(r,"around"),r=i.listSelections().slice();for(var e=0;e<r.length;e++)r[e]=(t=r[e],void 0,n=0<k.cmpPos(t.anchor,t.head),{anchor:new x(t.anchor.line,t.anchor.ch+(n?-1:1)),head:new x(t.head.line,t.head.ch+(n?1:-1))});i.setSelections(r)}else"both"==a?(i.replaceSelection(C+P,null),i.triggerElectric(C+P),i.execCommand("goCharLeft")):"addFour"==a&&(i.replaceSelection(C+C+C+C,"before"),i.execCommand("goCharRight"));var t,n})}(e,r)}}function S(e){var r=e.state.closeBrackets;return!r||r.override?r:e.getModeAt(e.getCursor()).closeBrackets||r}function s(e,r){var t=e.getRange(x(r.line,r.ch-1),x(r.line,r.ch+1));return 2==t.length?t:null}n(t.pairs+"`")});